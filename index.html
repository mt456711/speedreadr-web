<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<title>SpeedReadr</title>
<style>
body { font-family: sans-serif; margin: 2rem; }
#controls { margin-bottom: 1rem; }
#display { font-size: 2rem; font-weight: bold; height: 3rem; border: 1px solid #ccc; padding: 1rem; }
</style>
</head>
<body>
<h1>SpeedReadr</h1>
<input type='file' id='file-input' accept='.pdf'>
<div id='controls' hidden>
  <label>Words per minute:
    <input type='range' id='speed' min='100' max='800' value='300' step='50'>
  </label>
  <button id='start-btn'>Start</button>
  <button id='pause-btn'>Pause</button>
</div>
<div id='display'></div>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.15.349/pdf.worker.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js'></script>
<script>
const fileInput = document.getElementById('file-input');
const controls = document.getElementById('controls');
let wordList = [];
let index = 0;
let timer;

fileInput.addEventListener('change', async () => {
  const file = fileInput.files[0];
  if (!file) return;
  wordList = [];
  index = 0;
  const arrayBuffer = await file.arrayBuffer();
  const typedArray = new Uint8Array(arrayBuffer);
  const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;
  let text = '';
  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const content = await page.getTextContent();
    content.items.forEach(item => {
      text += item.str + ' ';
    });
  }
  if (text.trim().length < 20) {
    text = '';
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({ scale: 1.5 });
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      await page.render({ canvasContext: context, viewport }).promise;
      const result = await Tesseract.recognize(canvas, 'eng');
      text += result.data.text + ' ';
    }
  }
wordList = text.replace(/\s+/g, ' ').trim().split(' ');
  
  controls.hidden = false;
  });
  

const display = document.getElementById('display');
const speedSlider = document.getElementById('speed');
const startBtn = document.getElementById('start-btn');
const pauseBtn = document.getElementById('pause-btn');

function getPivot(word) {
  const len = word.length;
  if (len <= 1) return 0;
  if (len <= 5) return 1;
  if (len <= 9) return 2;
  if (len <= 13) return 3;
  return 4;
}

function showWord() {
  if (index >= wordList.length) {
    clearInterval(timer);
    return;
  }
  const word = wordList[index++];
  const pivotIndex = getPivot(word);
  const before = word.slice(0, pivotIndex);
  const pivot = word[pivotIndex] || '';
  const after = word.slice(pivotIndex + 1);
  display.innerHTML = `<span style='visibility:hidden'>${before}</span><span style='color:red'>${pivot}</span>${after}`;
}

startBtn.addEventListener('click', () => {
  clearInterval(timer);
  const delay = 60000 / parseInt(speedSlider.value, 10);
  showWord();
  timer = setInterval(showWord, delay);
});

pauseBtn.addEventListener('click', () => {
  clearInterval(timer);
});
</script>
</body>
</html>
